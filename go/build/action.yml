name: 'go-build'
description: 'Custom GitHub action that builds the Golang application. Optionally runs "buf build" steps when required BUF inputs are provided'

inputs:
  GO_VERSION:
    description: Golang version to be used for CI build
    required: true
  FLIPPCIRCLECIPULLER_REPO_TOKEN:
    description: Flipp circleci repo token
    required: true
  BUF_BUILD_USER:
    description: Buf CI user stored as secret
    required: false
  BUF_BUILD_API_TOKEN:
    description: Buf API token stored as secret
    required: false
  BUF_REPO_NAME:
    description: Name of the buf repo to be built
    required: false

runs:
  using: 'composite'
  steps:
    - uses: wishabi/github-actions/go/setup@PDA-325
      with:
        FLIPPCIRCLECIPULLER_REPO_TOKEN: ${{ inputs.FLIPPCIRCLECIPULLER_REPO_TOKEN }}
        BUF_BUILD_USER: ${{ inputs.BUF_BUILD_USER }}
        BUF_BUILD_API_TOKEN: ${{ inputs.BUF_BUILD_API_TOKEN }}
    - uses: wishabi/github-actions/go/deps@PDA-325
      with:
        BUF_REPO_NAME: ${{ inputs.BUF_REPO_NAME }}
